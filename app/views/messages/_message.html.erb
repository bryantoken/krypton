<div id="<%= dom_id message %>" class="flex <%= message.user == current_user ? 'justify-end' : 'justify-start' %> group items-start gap-3">
  
  <% if message.user != current_user %>
    <div class="opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-2 pt-1">
      <button onclick="setReply(<%= message.id %>, '<%= j message.body %>')" class="text-green-900 hover:text-green-500 transition-colors">
        <i class="ph ph-arrow-bend-up-left text-sm"></i>
      </button>
    </div>
  <% end %>

  <div class="max-w-[75%] space-y-1">
    <% if message.parent_id.present? %>
      <div class="text-[8px] text-green-800 uppercase tracking-widest ml-1">
        // REF: <%= truncate(message.parent.body, length: 20) %>
      </div>
    <% end %>

    <div class="relative border border-green-500/20 bg-green-500/5 px-4 py-3 rounded-xl group-hover:border-green-500/40 transition-all shadow-[0_0_10px_rgba(34,197,94,0.05)]">
      <p class="text-[13px] text-green-400 leading-relaxed"><%= message.body %></p>
      
      <div class="flex justify-between items-center mt-2 border-t border-green-500/10 pt-1">
        <span class="text-[8px] text-green-900 font-mono tracking-widest">
          <%= message.created_at.strftime("%H:%M:%S") %>
        </span>
        <% if message.user == current_user && message.created_at > 1.hour.ago %>
          <div class="opacity-0 group-hover:opacity-100 transition-opacity flex gap-2">
            <i class="ph ph-note-pencil text-[10px] text-green-900 hover:text-green-500 cursor-pointer"></i>
            <i class="ph ph-trash text-[10px] text-red-900 hover:text-red-700 cursor-pointer"></i>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <% if message.user == current_user %>
    <div class="opacity-0 group-hover:opacity-100 transition-opacity flex flex-col gap-2 pt-1">
      <button onclick="setReply(<%= message.id %>, '<%= j message.body %>')" class="text-green-900 hover:text-green-500 transition-colors">
        <i class="ph ph-arrow-bend-up-left text-sm"></i>
      </button>
    </div>
  <% end %>
</div>
