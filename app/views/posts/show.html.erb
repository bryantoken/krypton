<div class="min-h-screen bg-gray-950 py-12">
  <div class="max-w-4xl mx-auto px-4">
    
    <% if @post.cover_image.attached? %>
      <div class="w-full h-80 rounded-t-3xl overflow-hidden border-x border-t border-green-500/20 shadow-[0_-20px_50px_-12px_rgba(34,197,94,0.2)]">
        <%= image_tag @post.cover_image, class: "w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700" %>
      </div>
    <% end %>

    <article class="bg-gray-900/80 backdrop-blur-xl p-8 border border-green-500/20 rounded-b-3xl">
      <%# Cabeçalho com título e botões de ação (se for o dono) %>
      <div class="flex items-start justify-between gap-4 mb-6">
        <h1 class="font-archivo text-5xl text-green-500 tracking-tighter uppercase drop-shadow-[0_0_10px_rgba(34,197,94,0.4)]">
          <%= @post.title %>
        </h1>

        <%# Botões de Editar/Deletar - Apenas para o dono do post %>
        <% if user_signed_in? && @post.user == current_user %>
          <div class="flex gap-2 shrink-0">
            <%# Botão Editar %>
            <%= link_to edit_post_path(@post), 
                        class: "p-2.5 bg-green-500/10 rounded-lg border border-green-500/30 text-green-500 hover:bg-green-500/20 transition-all",
                        title: "Edit Signal" do %>
              <i class="ph-bold ph-pencil-simple text-base"></i>
            <% end %>

            <%# Botão Deletar %>
            <%= button_to @post, 
                          method: :delete,
                          data: { turbo_confirm: "⚠️ CRITICAL: Permanently delete this transmission? This action cannot be undone." },
                          class: "p-2.5 bg-red-950/50 rounded-lg border border-red-500/30 text-red-500 hover:bg-red-950/70 transition-all",
                          title: "Terminate Signal",
                          form: { class: "inline-block" } do %>
              <i class="ph-bold ph-trash text-base"></i>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="prose prose-invert prose-green max-w-none font-sans text-green-100/80 mb-12 trix-content">
        <%= render_embeds(@post.content.to_s) %>
      </div>

      <%# Terminal de Ações do Post %>
      <div class="flex items-center justify-between py-6 border-y border-green-500/10">
        <div class="flex items-center gap-6">
          <%= turbo_stream_from "likes_post_#{@post.id}" %>
          <%= render "posts/likes_count", post: @post %>
          
          <span class="text-xs text-green-800 font-mono uppercase">Status: <span class="text-green-500">Decrypted</span></span>
        </div>

        <%# Botão de Share %>
        <div class="relative inline-block" data-controller="share" data-share-url-value="<%= post_url(@post) %>">
          <button
            data-action="click->share#copy"
            class="flex items-center gap-2 px-4 py-2 rounded-lg border border-green-500/30 bg-green-500/5 text-[10px] font-archivo font-bold text-green-500 hover:bg-green-500/20 transition-all cursor-pointer uppercase tracking-widest"
          >
            <i class="ph-bold ph-share-network"></i>
            <span data-share-target="buttonText">Transmit Link</span>
          </button>
          
          <%# Feedback de Copiado %>
          <span data-share-target="feedback" class="absolute -top-8 left-1/2 -translate-x-1/2 hidden bg-green-500 text-black text-[8px] font-archivo font-bold py-1 px-3 rounded whitespace-nowrap uppercase">
            Link Transmitted!
          </span>
        </div>
      </div>

      <section class="mt-12">
        <h3 class="font-archivo text-xl text-green-500 uppercase mb-8 tracking-widest">Inbound Comments</h3>
        
        <%= turbo_stream_from "comments_post_#{@post.id}" %>
        <div id="comments_list_<%= @post.id %>" class="space-y-4 mb-8">
          <%= render @post.comments %>
        </div>

        <% if user_signed_in? %>
          <div class="mt-8 p-6 bg-green-500/5 rounded-xl border border-green-500/10">
            <%= render "comments/form", post: @post, comment: Comment.new %>
          </div>
        <% end %>
      </section>
    </article>

  </div>
</div>


