<div id="<%= dom_id post %>" class="group relative bg-gray-900/40 backdrop-blur-md border border-green-500/10 rounded-2xl overflow-hidden hover:border-green-500/40 hover:shadow-[0_0_30px_rgba(34,197,94,0.2)] transition-all duration-500 flex flex-col h-full">

  <%# Banner Clicável %>
  <%= link_to post, class: "relative h-40 w-full overflow-hidden block shrink-0" do %>
    <% if post.cover_image.attached? %>
      <%= image_tag post.cover_image, class: "w-full h-full object-cover grayscale group-hover:grayscale-0 group-hover:scale-105 transition-all duration-700 opacity-60 group-hover:opacity-100" %>
    <% else %>
      <div class="w-full h-full bg-green-950/20 flex items-center justify-center">
        <span class="text-[9px] font-archivo text-green-900 uppercase tracking-widest italic text-center px-4">Signal Offline</span>
      </div>
    <% end %>
    <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.1)_50%)] bg-[length:100%_4px] pointer-events-none"></div>
  <% end %>

  <div class="p-5 flex flex-col flex-grow">
    <div class="flex justify-between items-center mb-3">
      <div class="flex items-center gap-2">
        <span class="text-[9px] font-mono text-green-700 uppercase">Node: <%= post.user.email.split('@').first %></span>
        <% if user_signed_in? && post.user == current_user %>
          <span class="text-[7px] text-green-500/50 uppercase font-bold tracking-[0.2em] border-l border-green-500/20 pl-2 ml-1">Your Signal</span>
        <% end %>
      </div>
      <span class="text-[9px] font-mono text-green-900 uppercase">#<%= post.id %></span>
    </div>

    <%= link_to post, class: "block mb-2 no-underline" do %>
      <h2 class="font-archivo text-lg text-green-500 group-hover:text-green-300 transition-colors line-clamp-1 uppercase tracking-tight">
        <%= post.title %>
      </h2>
    <% end %>

    <div class="text-[11px] text-gray-400 line-clamp-2 font-sans mb-4 h-8 leading-relaxed opacity-80">
      <%= post.content.to_plain_text.truncate(100) %>
    </div>

    <%# Barra de Ações Inferior %>
    <div class="flex flex-col gap-4 pt-4 border-t border-green-500/10 mt-auto">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <%# Ações Básicas %>
          <%= link_to post, class: "p-2 bg-green-500/5 rounded border border-green-500/20 text-green-500 hover:bg-green-500/20 transition-all", title: "Decrypt Signal" do %>
            <i class="ph-bold ph-eye text-sm"></i>
          <% end %>

          <div data-controller="share" data-share-url-value="<%= post_url(post) %>" class="relative">
            <button type="button" data-action="click->share#copy"
                    class="p-2 bg-green-500/5 rounded border border-green-500/10 text-green-500 hover:bg-green-500/20 transition-all cursor-pointer group/share"
                    title="Transmit Signal">
              <i class="ph-bold ph-share-network text-sm"></i>
              <span data-share-target="feedback" class="absolute -top-10 left-1/2 -translate-x-1/2 hidden bg-green-500 text-black text-[8px] font-archivo font-bold py-1 px-2 rounded whitespace-nowrap uppercase pointer-events-none">
                Transmitted!
              </span>
            </button>
          </div>

          <%# Botão de Curtir: Apenas se logado e post NÃO for do usuário %>
          <% if user_signed_in? && post.user != current_user %>
            <%= turbo_stream_from "likes_post_#{post.id}" %>
            <div id="like_button_post_<%= post.id %>" class="flex items-center">
              <%= render "posts/like_button", post: post %>
            </div>
          <% end %>

          <%# Botões de Editar/Remover: Apenas se o post FOR do usuário %>
          <% if user_signed_in? && post.user == current_user %>
            <div class="flex gap-2 ml-1 border-l border-green-500/10 pl-3">
              <%= link_to edit_post_path(post),
                          class: "p-2 bg-blue-500/5 rounded border border-blue-500/20 text-blue-400 hover:bg-blue-500/20 transition-all",
                          title: "Edit Signal" do %>
                <i class="ph-bold ph-pencil-simple text-sm"></i>
              <% end %>

              <%= button_to post,
                            method: :delete,
                            data: { turbo_confirm: "⚠️ Delete this transmission?" },
                            class: "p-2 bg-red-500/5 rounded border border-red-500/20 text-red-400 hover:bg-red-500/20 transition-all cursor-pointer",
                            title: "Terminate Signal",
                            form: { class: "inline-block" } do %>
                <i class="ph-bold ph-trash text-sm"></i>
              <% end %>
            </div>
          <% end %>
        </div>

        <%# Contadores (Stats) %>
        <div class="flex items-center gap-3">
          <div class="flex items-center gap-1" id="likes_count_post_<%= post.id %>">
            <i class="ph-fill ph-heart <%= post.likes.any? ? 'text-green-400' : 'text-green-500/40' %> text-xs"></i>
            <span class="text-[10px] font-mono <%= post.likes.any? ? 'text-green-400' : 'text-green-500/40' %>">
              <%= post.likes.count %>
            </span>
          </div>
          <div class="flex items-center gap-1">
            <i class="ph-fill ph-chat-circle text-green-500/40 text-xs"></i>
            <span class="text-[10px] font-mono text-green-400"><%= post.comments.count %></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


